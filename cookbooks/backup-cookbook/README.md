backup Cookbook
===============
Chef cookbook to wrap backup rock, available at:
https://github.com/danfruehauf/backup

The cookbook provides a few simple templates and providers to easily deploy
backup rock on Chef environments.

Requirements
------------
That's the beauty, the cookbook doesn't have any major dependencies, most
likely if you have a linux system with /bin/bash and tar, the cookbook should
run.

Attributes
----------

#### backup::default
<table>
  <tr>
    <th>Key</th>
    <th>Type</th>
    <th>Description</th>
    <th>Default</th>
  </tr>
  <tr>
    <td><tt>['backup']['download_url']</tt></td>
    <td>String</td>
    <td>URL to download backup rock from - should be a .tar.gz package</td>
    <td><tt>https://github.com/danfruehauf/backup/tarball/master/</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['base_dir']</tt></td>
    <td>String</td>
    <td>Base directory for backups</td>
    <td><tt>/home/backup</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['backup_dir']</tt></td>
    <td>String</td>
    <td>Directory to use for backups</td>
    <td><tt>/home/backup/backup</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['models_dir']</tt></td>
    <td>String</td>
    <td>Directory to store models generated by this cookbook</td>
    <td><tt>/home/backup/models</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['bin_dir']</tt></td>
    <td>String</td>
    <td>Directory to deploy the backup rock to</td>
    <td><tt>/home/backup/bin</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['log_dir']</tt></td>
    <td>String</td>
    <td>Directory for log files</td>
    <td><tt>/var/log/backup</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['username']</tt></td>
    <td>String</td>
    <td>Username to create for backups</td>
    <td><tt>backup</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['group']</tt></td>
    <td>String</td>
    <td>Group to create for backups</td>
    <td><tt>backup</tt></td>
  </tr>
  <tr>
    <td><tt>['backup']['backups_to_keep']</tt></td>
    <td>Integer</td>
    <td>How many backups to keep</td>
    <td><tt>3</tt></td>
  </tr>
</table>

Usage
-----
#### backup::default
In your recipes, you should:
 * Include the backup recipe
 * Use the `backup` provider to define your backups

For example:
```
# Include the recipe
include_recipe "backup::default"

# Define files and directories to be backed up
files = []
files.push("/etc/cake")
files.push("/etc/chocolate_cake")

# Define databases to be backed up
databases = []

# A MySQL database
databases.push({
  'type'     => 'mysql',
  'host'     => database_host,
  'port'     => database_port,
  'name'     => database_name,
  'username' => database_username,
  'password' => database_password
})

# A PostgreSQL database
databases.push({
  'type'     => 'pgsql',
  'host'     => database_host,
  'port'     => database_port,
  'name'     => database_name,
  'username' => database_username,
  'password' => database_password
})

# Define a backup model for an application called 'cake' backing up the files
# and database we defined
backup 'cake' do
  params ({
    :databases => databases,,,,
    :files     => files
  })
end

```

Creating New Templates
----------------------
Alternatively, if you'd like to wrap that cookbook without 'touching' it, you
can use templates from your own cookbook. In the example below we'll use a
template model `my_template` from the cookbook `my_cookbook`. The template
should be in `my_cookbook/templates/default/my_template.sh.erb`.

Then you can use the backup template from your cookbook:
```
backup 'custom' do
  cookbook  'my_cookbook'
  template  'my_template'
  params    ({
    :databases => databases,,,,
    :files     => files
  })
end
```

Contributing
------------
1. Fork the repository on Github
2. Create a named feature branch (like `add_component_x`)
3. Write your changes
4. Write tests for your change (if applicable)
5. Run the tests, ensuring they all pass
6. Submit a Pull Request using Github

License and Authors
-------------------
Authors:
 * Dan Fruehauf <malkodan@gmail.com>

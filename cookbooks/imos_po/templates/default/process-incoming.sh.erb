#!/bin/bash

<%
@watchlists.each do |job_name, watchlist|
  watchlist['path'].each do |path|
    path = ::File.join(node['imos_po']['data_services']['incoming_dir'], path)
    execute = ::File.join(@data_services_dir, watchlist['execute'])
    execute_params = watchlist['execute_params']
    if execute_params
      execute_params.gsub!("$", "$$")
    end
%>
find <%= path %> -maxdepth 1 -type f -exec sudo -i -u <%= node['imos_po']['data_services']['user'] %> <%= @watch_exec_wrapper %> <%= job_name %> {} <%= execute %> <%= execute_params %> \;
<%
  end
end %>

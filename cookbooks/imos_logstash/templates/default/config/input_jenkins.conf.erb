# Autogenerated by Chef.
input {
  file {
    path => "/var/log/jenkins/jenkins.log"
    codec => json
    tags => [ "jenkins" ]
    type => "jenkins"
  }
}

filter {
  if [type] == "jenkins" {

    multiline {
      pattern => "Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec"
      what => "next"
    }

    mutate {
      add_field => { 'one_line_message' => '%{message}' }
    }

    mutate {
      gsub => ['one_line_message', "\n", " "]
    }

    grok {
      match => {
        "one_line_message" => "%{TIMESTAMP_JENKINS:timestamp} %{NOTSPACE:thread} %{WORD:method} %{LOGLEVEL:level}: %{GREEDYDATA:log_msg}"
      }
      break_on_match => false
    }

    grok {
      match => {
        "log_msg" => "%{GREEDYDATA:job_name} #%{NUMBER:job_number} %{GREEDYDATA:job_msg}: %{JENKINSJOBSTATUS:job_status}"
      }
      break_on_match => false
    }

    date {
      match => [ "timestamp" , "MMM dd, yyyy h:mm:ss a" ]
      timezone => "Australia/Hobart"
    }

  }
}

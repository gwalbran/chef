# Autogenerated by Chef.
<% @instances.each do |instance_params| %>

input {
  file {
    path => "<%= File.join(node['tomcat']['base'], instance_params['name'], 'logs', 'catalina.out') %>"
    codec => json
    tags => [ "webapp", "<%= instance_params['name'] %>"]
    type => "webapp_<%= instance_params['name'] %>"
  }
}

filter {

  if [type] == "webapp_<%= instance_params['name'] %>" {

    # App specific filters.
    <%
       instance_params['apps'].each do |app_params|
         app_artifact = app_params['artifact']
         filter_config = FilterFinder.get_filter_config(app_artifact)
         filter_config_content = ""
         if filter_config
           Chef::Log.info("Using logstash filter config '#{filter_config}' for application '#{app_artifact}'")
           begin
             filter_config_content = render "config/filters_#{filter_config}.conf.erb"
           rescue
             Chef::Log.warn("Could not find logstash filter configuration for #{app_artifact} - no stress!")
           end
         end
    %>
<%= filter_config_content %>
    <%
       end
    %>
  }
}

<% end %>

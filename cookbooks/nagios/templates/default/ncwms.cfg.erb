# NcWMS definitions
#
# Autogenerated by Chef.

<%
@nodes.each do |n|
  host_name = node['nagios']['server']['normalize_hostname'] ? n[node['nagios']['host_name_attribute']].downcase : n[node['nagios']['host_name_attribute']]
  # perform a search on web apps
  if n['webapps'] and n['webapps']['instances']
    n['webapps']['instances'].each do |webapp_instance|
      app_vhost       = webapp_instance['vhost']
      app_tomcat_port = webapp_instance['port']

      webapp_instance['apps'].each do |app|
        app_name     = app['name']
        app_artifact = app['artifact']

        if app_artifact == "ncwms_prod"
          protocol = webapp_instance['https'] ? "https://" : "http://"
          ncwms_url = "#{protocol}#{app_vhost}/#{app_name}"
%>
define service {
  service_description ncwms GetMap <%= ncwms_url %>
  check_command check_ncwms!GetMap!<%= ncwms_url %>!500!10
  host_name <%= host_name %>
  use default-service
  servicegroups ncwms
}

define service {
  service_description ncwms GetFeatureInfo <%= ncwms_url %>
  check_command check_ncwms!GetFeatureInfo!<%= ncwms_url %>!150!10
  host_name <%= host_name %>
  use default-service
  servicegroups ncwms
}
<%
        end

      end
    end
  end
end
%>


# Input processing definitions
#
# Autogenerated by Chef.

<% current_host_name = node['nagios']['server']['normalize_hostname'] ? node[node['nagios']['host_name_attribute']].downcase : node[node['nagios']['host_name_attribute']] -%>
<%
input_jobs = []
@nodes.uniq.each do |n|
  host_name = node['nagios']['server']['normalize_hostname'] ? n[node['nagios']['host_name_attribute']].downcase : n[node['nagios']['host_name_attribute']]

  if n['run_list'].include?("recipe[imos_po::data_services]") &&
    n['imos_po'] && n['imos_po']['data_services'] && n['imos_po']['data_services']['monitored_watch_jobs']
    n['imos_po']['data_services']['monitored_watch_jobs'].each do |input_job|
%>
define service {
  service_description input error <%= input_job %>
  host_name <%= host_name %>
  check_command check_input_error_<%= input_job %>
  servicegroups input
  use default-service
}

define service {
  service_description input incoming <%= input_job %>
  host_name <%= host_name %>
  check_command check_input_incoming_<%= input_job %>
  servicegroups input
  use default-service
}
<%
      input_jobs << input_job
    end
  end
end
%>

<% input_jobs.uniq.each do |input_job| -%>
define command {
        command_name    check_input_error_<%= input_job %>
        command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_input_error_<%= input_job %> -t 20
}

define command {
        command_name    check_input_incoming_<%= input_job %>
        command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_input_incoming_<%= input_job %> -t 20
}
<% end -%>
